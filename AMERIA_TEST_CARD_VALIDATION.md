# Ameria Bank Test Card Validation

## –ü—Ä–æ–±–ª–µ–º–∞

–í–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –±–∞–Ω–∫–æ–º —Å–∏—Å—Ç–µ–º–∞ –æ–¥–æ–±—Ä—è–ª–∞ –ø–ª–∞—Ç–µ–∂–∏ —Å –ª—é–±—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç—ã. –û–¥–Ω–∞–∫–æ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –±–∞–Ω–∫–æ–º, –ø–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω.

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ:

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 4 —Ü–∏—Ñ—Ä –∫–∞—Ä—Ç—ã –ø—Ä–æ—Ç–∏–≤ —Å–ø–∏—Å–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç
2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π —Å–ø–∏—Å–æ–∫** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–ø–∏—Å–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç —á–µ—Ä–µ–∑ admin panel
3. **–°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ** - –ø–ª–∞—Ç–µ–∂–∏ —Å –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ failed

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç –≤ Admin Panel

1. –ó–∞–π–¥–∏—Ç–µ –≤ `/admin/payments`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **Test Mode** –≤–∫–ª—é—á–µ–Ω
3. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–æ —Å–µ–∫—Ü–∏–∏ **"üîí Test Card Validation"**
4. –î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–∞–Ω–∫–æ–º:
   - –í–≤–µ–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1234`)
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Add"**
   - –ö–∞—Ä—Ç–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **"Strict Mode"** –≤–∫–ª—é—á–µ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
6. –ù–∞–∂–º–∏—Ç–µ **"Save"** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 2. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ:

1. –ë–∞–Ω–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç callback
2. –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ `GetPaymentDetails` API
3. –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã –∫–∞—Ä—Ç—ã –∏–∑ –ø–æ–ª—è `CardNumber` (—Ñ–æ—Ä–º–∞—Ç: `****1234`)
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∫–∞—Ä—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç
5. –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ:
   - –ü–ª–∞—Ç–µ–∂ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ **failed**
   - –ó–∞–∫–∞–∑ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–º
   - –í –ª–æ–≥–∞—Ö –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
6. –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ:
   - –ü–ª–∞—Ç–µ–∂ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ **completed**
   - –ó–∞–∫–∞–∑ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–∞—Ä—Ç –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

**–£—Å–ø–µ—à–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
```
‚úÖ [AMERIA PAYMENT] Test card validated successfully: {
  paymentId: "...",
  orderId: "...",
  cardLast4: "1234"
}
```

**–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞:**
```
‚ùå [AMERIA PAYMENT] Test card validation failed: {
  paymentId: "...",
  orderId: "...",
  cardNumber: "****5678",
  cardLast4: "5678",
  message: "Test card 5678 is not in the allowed list...",
  allowedCards: ["1234", "9012"]
}
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- **allowedTestCards** (string[]): –ú–∞—Å—Å–∏–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 4 —Ü–∏—Ñ—Ä —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç
  - –ü—Ä–∏–º–µ—Ä: `["1234", "5678", "9012"]`
  - –§–æ—Ä–º–∞—Ç: —Ç–æ–ª—å–∫–æ 4 —Ü–∏—Ñ—Ä—ã

- **testCardStrictMode** (boolean): –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  - `true`: –¢–æ–ª—å–∫–æ –∫–∞—Ä—Ç—ã –∏–∑ —Å–ø–∏—Å–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  - `false`: –í—Å–µ –∫–∞—Ä—Ç—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞)

### –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `Settings` —Å –∫–ª—é—á–æ–º `payment.ameria.config` –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º**: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `testMode === true`
2. **–ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º**: –í –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–∞–Ω–∫–∞
4. **–ù–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ–±–æ–π—Ç–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ –±–∞–Ω–∫–æ–º

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç

```typescript
// –í admin panel –¥–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç—ã:
// - –í–≤–µ–¥–∏—Ç–µ "1234" ‚Üí Add
// - –í–≤–µ–¥–∏—Ç–µ "5678" ‚Üí Add
// - –í–≤–µ–¥–∏—Ç–µ "9012" ‚Üí Add

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
allowedTestCards: ["1234", "5678", "9012"]
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```typescript
// –í admin panel —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É "Strict Mode"
// –¢–µ–ø–µ—Ä—å –≤—Å–µ –∫–∞—Ä—Ç—ã –±—É–¥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
testCardStrictMode: false
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã

- `apps/web/lib/services/payments/test-card-validator.ts` - –ú–æ–¥—É–ª—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `apps/web/lib/services/payments/ameria-payment.service.ts` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ callback handler
- `apps/web/lib/services/payments/payment-config.service.ts` - –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `apps/web/app/admin/payments/page.tsx` - UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏

### API

–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –º–µ—Ç–æ–¥–µ `handleCallback` —Å–µ—Ä–≤–∏—Å–∞ `AmeriaPaymentService`:

```typescript
// –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è paymentDetails –æ—Ç –±–∞–Ω–∫–∞:
const cardValidation = validateTestCard(
  paymentDetails.CardNumber,
  {
    allowedLast4Digits: config.allowedTestCards || [],
    strictMode: config.testCardStrictMode ?? true,
  },
  config.testMode
);

if (!cardValidation.valid) {
  // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂
  isSuccess = false;
}
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ –∫–∞—Ä—Ç—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–æ–∫ –≤ admin panel
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã –≤–≤–µ–¥–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è —Ç–æ—á–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ä—Ç—ã –Ω–µ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `testCardStrictMode` –≤–∫–ª—é—á–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (`testMode === true`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –º–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–≤–æ–¥–∏—Ç–µ —Ä–æ–≤–Ω–æ 4 —Ü–∏—Ñ—Ä—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–∞—Ä—Ç–∞ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ (–¥—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è)
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

## –ú–∏–≥—Ä–∞—Ü–∏—è

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/admin/payments`
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –≤—Ä—É—á–Ω—É—é
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
4. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—ã

–ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.





